#!/bin/bash
set -e

# Путь к директории бота
BOT_DIR="/app/telegram_bot"

echo "================================================"
echo "Скрипт start_bot.sh запущен в $(date)"
echo "================================================"

# Сначала ждем, пока модель полностью загрузится
echo "Ожидаем загрузки модели перед запуском бота..."
bash "${BOT_DIR}/wait_for_model.sh"
WAIT_RESULT=$?

echo "Результат ожидания: $WAIT_RESULT (0 = успех)"

# Если скрипт ожидания успешно завершился, запускаем бота
if [ $WAIT_RESULT -eq 0 ]; then
    echo "Модель успешно загружена, запускаем Telegram бота..."
    echo "================================================"
    cd "${BOT_DIR}"
    python bot.py
else
    echo "Не удалось дождаться загрузки модели. Бот не будет запущен."
    echo "Проверьте состояние сервиса model_initializer и доступность модели."
    echo "================================================"
    exit 1
fi 